<!DOCTYPE html>
<html lang="en">
 <head>
 </head>
 <head>
  <meta charset="utf-8"/>
  <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
  <link href="/connector-pub/favicon-48x48.png" rel="shortcut icon" type="image/jpg"/>
  <link href="/css/o3-cool.css" id="master-css" rel="stylesheet"/>
  <link href="/css/all.css" id="master-css" rel="stylesheet"/>
  <link href="/assets/branding.css" rel="stylesheet"/>
  <link href="/connector-pub/branding.css" rel="stylesheet"/>
  <title>
   Developer Portal- Sandbox
  </title>
 </head>
 <body>
 </body>
 <body>
  <div class="off-canvas off-canvas-overlay off-canvas-right wd-900" id="offCanvas3">
  </div>
  <div class="content pd-0 pos-fixed wd-100v" style="z-index:1000">
   <div class="content-header">
    <div class="content-search">
     <span>
      <h5 class="mg-b-0 tx-spacing--1">
       Developer Portal
      </h5>
     </span>
    </div>
    <nav class="nav wd-180">
     <div class="navbar-right d-flex align-items-center">
     </div>
    </nav>
   </div>
  </div>
  <aside class="aside aside-fixed">
   <div class="aside-header d-flex justify-content-center">
    <a class="aside-logo" href="/">
     <img height="55px" src="/connector-pub/logo/tide-uk-logo.png"/>
    </a>
   </div>
   <div class="aside-body">
    <!-- aside-loggedin-->
    <ul class="nav nav-aside">
     <div class="documentation-sidebar-main">
      <li class="nav-label mt-3">
       Documentation
      </li>
      <li class="nav-item with-sub show">
       <a class="nav-link parent-link">
        <i data-feather="book">
        </i>
        <span class="text-uppercase">
         Tide UK Portal
        </span>
       </a>
       <ul class="mt-2 documentation-group" style="padding-left: 0px;">
        <div class="dropdown-divider mb-1">
        </div>
        <li>
         <a class="documentation-links mt-2 mb-2" href="/perry/developer/documentation?resource=tide-uk-portal&amp;document=docs/tpp-onboarding/introduction.md">
          <span style="word-wrap: break-word;white-space: normal;line-height: normal;display: block;">
           Introduction
          </span>
         </a>
        </li>
        <li class="nav-item with-sub nav-label mt-2">
         <span>
          Sandbox
         </span>
        </li>
        <ul class="py-0">
         <li>
          <a class="documentation-links mt-1 mb-1" href="/perry/developer/documentation?resource=tide-uk-portal&amp;document=docs/tpp-onboarding/sandbox.md">
           <span style="word-wrap: break-word;white-space: normal;line-height: normal;display: block;">
            Overview
           </span>
          </a>
         </li>
         <li>
          <a class="documentation-links mt-1 mb-1" href="/perry/developer/documentation?resource=tide-uk-portal&amp;document=docs/tpp-onboarding/step-by-step-guide.md">
           <span style="word-wrap: break-word;white-space: normal;line-height: normal;display: block;">
            Step by Step Guide
           </span>
          </a>
         </li>
         <li>
          <a class="documentation-links mt-1 mb-1" href="/perry/developer/documentation?resource=tide-uk-portal&amp;document=docs/tpp-onboarding/security-model.md">
           <span style="word-wrap: break-word;white-space: normal;line-height: normal;display: block;">
            Security Model
           </span>
          </a>
         </li>
        </ul>
        <li class="nav-item with-sub nav-label mt-2">
         <span>
          Production
         </span>
        </li>
        <ul class="py-0">
         <li>
          <a class="documentation-links mt-1 mb-1" href="/perry/developer/documentation?resource=tide-uk-portal&amp;document=docs/tpp-onboarding/production.md">
           <span style="word-wrap: break-word;white-space: normal;line-height: normal;display: block;">
            Overview
           </span>
          </a>
         </li>
         <li>
          <a class="documentation-links mt-1 mb-1" href="/perry/developer/documentation?resource=tide-uk-portal&amp;document=docs/tpp-onboarding/security-model.md">
           <span style="word-wrap: break-word;white-space: normal;line-height: normal;display: block;">
            Security Model
           </span>
          </a>
         </li>
        </ul>
        <li>
         <a class="documentation-links mt-2 mb-2" href="/perry/developer/documentation?resource=tide-uk-portal&amp;document=swagger/tide-ais-schema.yaml">
          <span style="word-wrap: break-word;white-space: normal;line-height: normal;display: block;">
           AISP Specification
          </span>
         </a>
        </li>
        <li>
         <a class="documentation-links mt-2 mb-2" href="/perry/developer/documentation?resource=tide-uk-portal&amp;document=swagger/tide-pis-schema.yaml">
          <span style="word-wrap: break-word;white-space: normal;line-height: normal;display: block;">
           PISP Specification
          </span>
         </a>
        </li>
        <li>
         <a class="documentation-links mt-2 mb-2" href="/perry/developer/documentation?resource=tide-uk-portal&amp;document=swagger/tide-cbpii-schema.yaml">
          <span style="word-wrap: break-word;white-space: normal;line-height: normal;display: block;">
           CBPII Specification
          </span>
         </a>
        </li>
        <div class="dropdown-divider mb-1">
        </div>
        <li class="nav-item with-sub nav-label mt-2">
         <span>
          FAQ
         </span>
        </li>
        <ul class="py-0">
         <li>
          <a class="documentation-links mt-1 mb-1" href="/perry/developer/documentation?resource=tide-uk-portal&amp;document=docs/FAQ/usage-guides.md">
           <span style="word-wrap: break-word;white-space: normal;line-height: normal;display: block;">
            Usage Guides
           </span>
          </a>
         </li>
         <li>
          <a class="documentation-links mt-1 mb-1" href="/perry/developer/documentation?resource=tide-uk-portal&amp;document=docs/FAQ/cert-migration.md">
           <span style="word-wrap: break-word;white-space: normal;line-height: normal;display: block;">
            Certificate Migration
           </span>
          </a>
         </li>
         <li>
          <a class="documentation-links mt-1 mb-1" href="/perry/developer/documentation?resource=tide-uk-portal&amp;document=docs/FAQ/faqs.md">
           <span style="word-wrap: break-word;white-space: normal;line-height: normal;display: block;">
            FAQ
           </span>
          </a>
         </li>
         <li>
          <a class="documentation-links mt-1 mb-1" href="/perry/developer/documentation?resource=tide-uk-portal&amp;document=docs/FAQ/glossary.md">
           <span style="word-wrap: break-word;white-space: normal;line-height: normal;display: block;">
            Glossary
           </span>
          </a>
         </li>
         <li>
          <a class="documentation-links mt-1 mb-1" href="/perry/developer/documentation?resource=tide-uk-portal&amp;document=docs/FAQ/contact-us.md">
           <span style="word-wrap: break-word;white-space: normal;line-height: normal;display: block;">
            Contact Us
           </span>
          </a>
         </li>
         <li>
          <a class="documentation-links mt-1 mb-1" href="/perry/developer/documentation?resource=tide-uk-portal&amp;document=docs/Help/30-downloads.md">
           <span style="word-wrap: break-word;white-space: normal;line-height: normal;display: block;">
            Help
           </span>
          </a>
         </li>
        </ul>
       </ul>
      </li>
     </div>
    </ul>
   </div>
  </aside>
  <div class="content content-developer-portal pd-0 pd-0 documentation-content" style="overflow-x: hidden;padding-top:70px">
   <div class="container-fluid pd-x-0 pd-lg-x-10 pd-xl-x-0">
   </div>
   <div class="container-fluid pd-x-0 pd-lg-x-10 pd-xl-x-0">
    <div class="documentation" data-document='/&lt;h1&gt;Guide to connect to sandbox&lt;/h1&gt;
&lt;h2&gt;Step 1: Pre-Requisites for TPP&lt;/h2&gt;
&lt;p&gt;Ensure that the following pre-requisites are met before onboarding onto Tide.
The TPP has registered on the Directory Sandbox - &lt;a href="https://directory.openbanking.org.uk/s/login/"&gt;https://directory.openbanking.org.uk/s/login/&lt;/a&gt;
The TPP has at least one software statement created on the Directory Sandbox environment
The TPP has at least one transport certificate created for each of its software statements.
The TPP has at least one redirect URI for each of its software statements.
The TPP has a copy of the OB root and issuing certificate attached. &lt;/p&gt;
&lt;h2&gt;Step 2: Register TPP with Bank using Dynamic Client Registration&lt;/h2&gt;
&lt;p&gt;See &lt;a href="http://openid.net/specs/openid-connect-registration-1_0-21.html"&gt;http://openid.net/specs/openid-connect-registration-1_0-21.html&lt;/a&gt;
Claims required in dynamic client registration for Banks are as follows&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Field Names&lt;/th&gt;
&lt;th&gt;Example Values&lt;/th&gt;
&lt;th&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;token_endpoint_auth_signing_alg&lt;/td&gt;
&lt;td&gt;PS256&lt;/td&gt;
&lt;td&gt;Signature algorithm used JWK.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;grant_types&lt;/td&gt;
&lt;td&gt;authorization_code, client_credentials&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;subject_type&lt;/td&gt;
&lt;td&gt;public&lt;/td&gt;
&lt;td&gt;subject_type requested for responses to this client_id.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;application_type&lt;/td&gt;
&lt;td&gt;web&lt;/td&gt;
&lt;td&gt;The issuer must be your software ID. This is important as it&amp;#39;s used verify it matches the SSA software ID claim.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;redirect_uris&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;All redirect Uris should be added in the claims&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;token_endpoint_auth_method&lt;/td&gt;
&lt;td&gt;client_secret_basic&lt;/td&gt;
&lt;td&gt;Requested authentication method for the Token Endpoint.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;aud&lt;/td&gt;
&lt;td&gt;0015800001ZEc3hAAD&lt;/td&gt;
&lt;td&gt;The audience must match the AS issuer ID.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;scopes&lt;/td&gt;
&lt;td&gt;openid, accounts, payments&lt;/td&gt;
&lt;td&gt;The scopes will depend on your role from the FCA (AISP and/or PISP)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;request_object_signing_alg&lt;/td&gt;
&lt;td&gt;none&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;exp&lt;/td&gt;
&lt;td&gt;timestamp&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;iat&lt;/td&gt;
&lt;td&gt;timestamp&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;jti&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;UUID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;response_types&lt;/td&gt;
&lt;td&gt;code, code id_token&lt;/td&gt;
&lt;td&gt;UUJSON array containing a list of the OAuth 2.0 response_type values that the Client is declaring that it will restrict itself to using&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;id_token_signed_response_alg&lt;/td&gt;
&lt;td&gt;PS256&lt;/td&gt;
&lt;td&gt;JWS alg algorithm&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;software_statement&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;UUID&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;p&gt;2.1 Example Registration Request JWT (Python)
This code is compatible with python3.6 and requires the jwcrypto module (pip install jwcrypto)&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;import time, uuid
from jwcrypto import jwt
from jwcrypto import jwk

# The software statement ID (software_id) of the software statement created in software statements (MIT).
SOFTWARE_STATEMENT_ID = &amp;quot;&amp;quot;
#  Value of the kid parameter associated with the signing certificate generated in Generate a
# transport/signing certificate pair (please note that you need to use the signing certificate kid).
KID = &amp;quot;&amp;quot;
# Your private signing key. You will use this to sign your JWT.
PRIVATE_RSA_KEY = &amp;quot;&amp;quot;&amp;quot;
-----BEGIN PRIVATE KEY-----
-----END PRIVATE KEY-----
&amp;quot;&amp;quot;&amp;quot;

SOFTWARE_STATEMENT = &amp;quot;&amp;quot;

def make_registration_jwt(software_statement_id: str, kid: str, software_statement: str) -&amp;gt; str:
    jwt_iat = int(time.time())
    jwt_exp = jwt_iat + 3600
    header = dict(alg=&amp;#39;RS256&amp;#39;, kid=kid, typ=&amp;#39;JWT&amp;#39;)
    claims = dict(
        token_endpoint_auth_signing_alg=&amp;quot;PS256&amp;quot;,
        grant_types=[&amp;quot;authorization_code&amp;quot;, &amp;quot;client_credentials&amp;quot;],
        subject_type=&amp;quot;public&amp;quot;,
        application_type=&amp;quot;web&amp;quot;,
        iss=software_statement_id,
        redirect_uris=[&amp;quot;https://app.getpostman.com/oauth2/callback&amp;quot;],
        token_endpoint_auth_method=&amp;quot;client_secret_basic&amp;quot;,
        aud=&amp;quot;0015800001ZEc3hAAD&amp;quot;,
        scope= &amp;quot;openid accounts payments&amp;quot;,   #accounts for AISP or payments for PISP or both
        request_object_signing_alg=&amp;quot;none&amp;quot;,
        exp=jwt_exp,
        iat=jwt_iat,
        jti=str(uuid.uuid4()),
        response_types=[&amp;quot;code&amp;quot;, &amp;quot;code id_token&amp;quot;],
        id_token_signed_response_alg=&amp;quot;RS256&amp;quot;,
        software_statement=software_statement
     )

    token = jwt.JWT(header=header, claims=claims)
    key_obj = jwk.JWK.from_pem(PRIVATE_RSA_KEY.encode(&amp;#39;latin-1&amp;#39;))
    token.make_signed_token(key_obj)
    signed_token = token.serialize()

    print(signed_token)
    return signed_token

make_registration_jwt(SOFTWARE_STATEMENT_ID, KID, SOFTWARE_STATEMENT)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;2.2 Request Registration Endpoint Example (Python): &lt;/p&gt;
&lt;pre&gt;&lt;code&gt;headers = {&amp;#39;Content-Type&amp;#39;: &amp;#39;application/jwt&amp;#39;}
client = (&amp;#39;./transport.pem&amp;#39;, &amp;#39;./transports.key&amp;#39;)
response = requests.post(&amp;quot;https://ob-api1.sandbox.tide.co:4501/v1.0/dynamic-client-registration/v3.1/register&amp;quot;,
                                registration_request,
                                headers=headers,
                                verify=False,
                                cert=client
                                )
print(response.content)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The response you get from this registration is exactly the same as the one described by the OIDC dynamic registration.
You should now have successfully onboarded your TPP with the ASPSP and received a client ID; you will need this client ID for future interactions with the ASPSP.&lt;/p&gt;
&lt;p&gt;2.3 Environment File download&lt;/p&gt;
&lt;p&gt;Once a TPP successfully registers to Ozone, they can download the environment file for their client via an ozone helper api&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Endpoint: https://ob-api1.sandbox.tide.co:4501/ozone/v1.0/postman/environment

Headers: Authorization: Basic &amp;lt;token&amp;gt;
The token is the base64 encoded string of clientId:clientsecret
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;On successful response the TPP can then save the environment file on to their local system.&lt;/p&gt;
&lt;h2&gt;Step 3: Import Environment Files and Collections To Postman&lt;/h2&gt;
&lt;p&gt;3.1. Import Environment Files and Collections into Postman&lt;/p&gt;
&lt;p&gt;&lt;img src="../../assets/images/postmanimport1.png" alt=""&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="../../assets/images/postmanimport2.png" alt=""&gt;&lt;/p&gt;
&lt;p&gt;3.2) Check URLs and Environments are loaded successfully &lt;/p&gt;
&lt;p&gt;3.3) Add Client Certificates
Add the following ASPSP end points into Postman;
&lt;a href="https://ob-api1.sandbox.tide.co:4501"&gt;https://ob-api1.sandbox.tide.co:4501&lt;/a&gt;
&lt;a href="https://ob-auth1.sandbox.tide.co:4201/token"&gt;https://ob-auth1.sandbox.tide.co:4201/token&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The CRT should be set to the transport certificate downloaded from the open banking directory. The Key value should be set to the private key for the transport certificate.&lt;/p&gt;
&lt;p&gt;3.4) SSL Certificate Verification (TPP)
In Postman settings ensure SSL Certificate Verification is set to off.&lt;/p&gt;
&lt;h2&gt;Step 4: Account Information Flow&lt;/h2&gt;
&lt;p&gt;4.1) Client Credentials Grant&lt;/p&gt;
&lt;p&gt;&lt;img src="../../assets/images/ccg.png" alt=""&gt;&lt;/p&gt;
&lt;p&gt;4.2) Account Access Consent&lt;/p&gt;
&lt;p&gt;&lt;img src="../../assets/images/accountaccess.png" alt=""&gt;&lt;/p&gt;
&lt;p&gt;4.3) PSU Consent Flow
TPPs can generate the consent flow URL by postman&lt;/p&gt;
&lt;p&gt;&lt;img src="../../assets/images/consent1.png" alt=""&gt;&lt;/p&gt;
&lt;p&gt;Once the URL is constructed, open the URL to initiate the PSU consent flow&lt;/p&gt;
&lt;p&gt;Authenticate user&lt;/p&gt;
&lt;p&gt;&lt;img src="../../assets/images/consent2.png" alt=""&gt;&lt;/p&gt;
&lt;p&gt;Sandbox User Accounts&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;user&lt;/th&gt;
&lt;th&gt;password&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;rora&lt;/td&gt;
&lt;td&gt;rora&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;mits&lt;/td&gt;
&lt;td&gt;mits&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ivsa&lt;/td&gt;
&lt;td&gt;ivsa&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;p&gt;Select accounts&lt;/p&gt;
&lt;p&gt;&lt;img src="../../assets/images/consent3.png" alt=""&gt;&lt;/p&gt;
&lt;p&gt;Once the PSU consent is successful, Ozone bank will redirect back to the redirect URI. Copy the auth code from the URL&lt;/p&gt;
&lt;p&gt;&lt;img src="../../assets/images/consent4.png" alt=""&gt;&lt;/p&gt;
&lt;p&gt;4.4) Generate the access token&lt;/p&gt;
&lt;p&gt;&lt;img src="../../assets/images/accesstoken.png" alt=""&gt;&lt;/p&gt;
&lt;h2&gt;Step 5: Retrieve Account and Transaction Data&lt;/h2&gt;
&lt;p&gt;Retrieve Account Data&lt;/p&gt;
&lt;p&gt;&lt;img src="../../assets/images/accounts.png" alt=""&gt;&lt;/p&gt;
&lt;p&gt;Retrieve Transaction Data&lt;/p&gt;
&lt;p&gt;&lt;img src="../../assets/images/transactions.png" alt=""&gt;&lt;/p&gt;
'>
     <div class="row">
      <div class="col-md-2 bd-r documentation-sidebar pr-0">
       <ul class="nav nav-aside mb-0 mt-4">
        <div class="pos-relative">
         <li class="nav-label pl-3">
          Tide UK Portal
         </li>
        </div>
       </ul>
       <ul class="nav flex-column flex-nowrap overflow-hidden">
        <div class="dropdown-divider">
        </div>
        <li class="nav-item doc-navigation">
         <a class="nav-link text-truncate" href="/perry/developer/documentation?resource=tide-uk-portal&amp;document=docs/tpp-onboarding/introduction.md">
          <span class="d-none d-sm-inline">
           Introduction
          </span>
         </a>
        </li>
        <li class="nav-item pos-relative doc-navigation">
         <a class="nav-link collapsed text-truncate" data-target="#submenu1" data-toggle="collapse" href="#submenu1">
          <i class="fas fa-chevron-right pos-absolute r-15 t-15">
          </i>
          <span class="d-none d-sm-inline">
           Sandbox
          </span>
         </a>
         <div aria-expanded="false" class="collapse" id="submenu1">
          <ul class="flex-column pl-2 nav">
           <li class="nav-item doc-navigation">
            <a class="nav-link" href="/perry/developer/documentation?resource=tide-uk-portal&amp;document=docs/tpp-onboarding/sandbox.md">
             <span>
              Overview
             </span>
            </a>
           </li>
           <li class="nav-item doc-navigation">
            <a class="nav-link" href="/perry/developer/documentation?resource=tide-uk-portal&amp;document=docs/tpp-onboarding/step-by-step-guide.md">
             <span>
              Step by Step Guide
             </span>
            </a>
           </li>
           <li class="nav-item doc-navigation">
            <a class="nav-link" href="/perry/developer/documentation?resource=tide-uk-portal&amp;document=docs/tpp-onboarding/security-model.md">
             <span>
              Security Model
             </span>
            </a>
           </li>
          </ul>
         </div>
        </li>
        <li class="nav-item pos-relative doc-navigation">
         <a class="nav-link collapsed text-truncate" data-target="#submenu1" data-toggle="collapse" href="#submenu1">
          <i class="fas fa-chevron-right pos-absolute r-15 t-15">
          </i>
          <span class="d-none d-sm-inline">
           Production
          </span>
         </a>
         <div aria-expanded="false" class="collapse" id="submenu1">
          <ul class="flex-column pl-2 nav">
           <li class="nav-item doc-navigation">
            <a class="nav-link" href="/perry/developer/documentation?resource=tide-uk-portal&amp;document=docs/tpp-onboarding/production.md">
             <span>
              Overview
             </span>
            </a>
           </li>
           <li class="nav-item doc-navigation">
            <a class="nav-link" href="/perry/developer/documentation?resource=tide-uk-portal&amp;document=docs/tpp-onboarding/security-model.md">
             <span>
              Security Model
             </span>
            </a>
           </li>
          </ul>
         </div>
        </li>
        <li class="nav-item doc-navigation">
         <a class="nav-link text-truncate" href="/perry/developer/documentation?resource=tide-uk-portal&amp;document=swagger/tide-ais-schema.yaml">
          <span class="d-none d-sm-inline">
           AISP Specification
          </span>
         </a>
        </li>
        <li class="nav-item doc-navigation">
         <a class="nav-link text-truncate" href="/perry/developer/documentation?resource=tide-uk-portal&amp;document=swagger/tide-pis-schema.yaml">
          <span class="d-none d-sm-inline">
           PISP Specification
          </span>
         </a>
        </li>
        <li class="nav-item doc-navigation">
         <a class="nav-link text-truncate" href="/perry/developer/documentation?resource=tide-uk-portal&amp;document=swagger/tide-cbpii-schema.yaml">
          <span class="d-none d-sm-inline">
           CBPII Specification
          </span>
         </a>
        </li>
        <div class="dropdown-divider">
        </div>
        <li class="nav-item pos-relative doc-navigation">
         <a class="nav-link collapsed text-truncate" data-target="#submenu1" data-toggle="collapse" href="#submenu1">
          <i class="fas fa-chevron-right pos-absolute r-15 t-15">
          </i>
          <span class="d-none d-sm-inline">
           FAQ
          </span>
         </a>
         <div aria-expanded="false" class="collapse" id="submenu1">
          <ul class="flex-column pl-2 nav">
           <li class="nav-item doc-navigation">
            <a class="nav-link" href="/perry/developer/documentation?resource=tide-uk-portal&amp;document=docs/FAQ/usage-guides.md">
             <span>
              Usage Guides
             </span>
            </a>
           </li>
           <li class="nav-item doc-navigation">
            <a class="nav-link" href="/perry/developer/documentation?resource=tide-uk-portal&amp;document=docs/FAQ/cert-migration.md">
             <span>
              Certificate Migration
             </span>
            </a>
           </li>
           <li class="nav-item doc-navigation">
            <a class="nav-link" href="/perry/developer/documentation?resource=tide-uk-portal&amp;document=docs/FAQ/faqs.md">
             <span>
              FAQ
             </span>
            </a>
           </li>
           <li class="nav-item doc-navigation">
            <a class="nav-link" href="/perry/developer/documentation?resource=tide-uk-portal&amp;document=docs/FAQ/glossary.md">
             <span>
              Glossary
             </span>
            </a>
           </li>
           <li class="nav-item doc-navigation">
            <a class="nav-link" href="/perry/developer/documentation?resource=tide-uk-portal&amp;document=docs/FAQ/contact-us.md">
             <span>
              Contact Us
             </span>
            </a>
           </li>
           <li class="nav-item doc-navigation">
            <a class="nav-link" href="/perry/developer/documentation?resource=tide-uk-portal&amp;document=docs/Help/30-downloads.md">
             <span>
              Help
             </span>
            </a>
           </li>
          </ul>
         </div>
        </li>
       </ul>
      </div>
      <div class="col-md-10 pd-0">
       <div class="pt-2 pl-4 pb-0 bd-b">
        <div class="pd-x-0 pd-lg-x-10 pd-xl-x-0 container-fluid">
         <div class="d-sm-flex align-items-center justify-content-between mg-b-20 mg-lg-b-25 mg-xl-b-10">
          <div>
           <nav aria-label="breadcrumb">
            <ol class="breadcrumb breadcrumb-style1 mg-b-10">
             <li aria-current="page" class="breadcrumb-item active">
              <a href="/perry/developer/documentation?resource=tide-uk-portal&amp;document=undefined">
               Tide UK Portal
              </a>
             </li>
             <li aria-current="bank" class="breadcrumb-item active">
              <a href="#">
               Sandbox
              </a>
             </li>
            </ol>
           </nav>
           <h4 class="mg-b-12 tx-spacing--1 pb-0">
            Sandbox
           </h4>
          </div>
         </div>
        </div>
       </div>
       <div class="p-4 middle-block">
        <div class="row">
         <div class="markdown-content col-md-9">
          <h1>
           Guide to connect to sandbox
          </h1>
          <h2>
           Step 1: Pre-Requisites for TPP
          </h2>
          <p>
           Ensure that the following pre-requisites are met before onboarding onto Tide.
The TPP has registered on the Directory Sandbox -
           <a href="https://directory.openbanking.org.uk/s/login/">
            https://directory.openbanking.org.uk/s/login/
           </a>
           The TPP has at least one software statement created on the Directory Sandbox environment
The TPP has at least one transport certificate created for each of its software statements.
The TPP has at least one redirect URI for each of its software statements.
The TPP has a copy of the OB root and issuing certificate attached.
          </p>
          <h2>
           Step 2: Register TPP with Bank using Dynamic Client Registration
          </h2>
          <p>
           See
           <a href="http://openid.net/specs/openid-connect-registration-1_0-21.html">
            http://openid.net/specs/openid-connect-registration-1_0-21.html
           </a>
           Claims required in dynamic client registration for Banks are as follows
          </p>
          <table>
           <thead>
            <tr>
             <th>
              Field Names
             </th>
             <th>
              Example Values
             </th>
             <th>
              Description
             </th>
            </tr>
           </thead>
           <tbody>
            <tr>
             <td>
              token_endpoint_auth_signing_alg
             </td>
             <td>
              PS256
             </td>
             <td>
              Signature algorithm used JWK.
             </td>
            </tr>
            <tr>
             <td>
              grant_types
             </td>
             <td>
              authorization_code, client_credentials
             </td>
             <td>
             </td>
            </tr>
            <tr>
             <td>
              subject_type
             </td>
             <td>
              public
             </td>
             <td>
              subject_type requested for responses to this client_id.
             </td>
            </tr>
            <tr>
             <td>
              application_type
             </td>
             <td>
              web
             </td>
             <td>
              The issuer must be your software ID. This is important as it's used verify it matches the SSA software ID claim.
             </td>
            </tr>
            <tr>
             <td>
              redirect_uris
             </td>
             <td>
             </td>
             <td>
              All redirect Uris should be added in the claims
             </td>
            </tr>
            <tr>
             <td>
              token_endpoint_auth_method
             </td>
             <td>
              client_secret_basic
             </td>
             <td>
              Requested authentication method for the Token Endpoint.
             </td>
            </tr>
            <tr>
             <td>
              aud
             </td>
             <td>
              0015800001ZEc3hAAD
             </td>
             <td>
              The audience must match the AS issuer ID.
             </td>
            </tr>
            <tr>
             <td>
              scopes
             </td>
             <td>
              openid, accounts, payments
             </td>
             <td>
              The scopes will depend on your role from the FCA (AISP and/or PISP)
             </td>
            </tr>
            <tr>
             <td>
              request_object_signing_alg
             </td>
             <td>
              none
             </td>
             <td>
             </td>
            </tr>
            <tr>
             <td>
              exp
             </td>
             <td>
              timestamp
             </td>
             <td>
             </td>
            </tr>
            <tr>
             <td>
              iat
             </td>
             <td>
              timestamp
             </td>
             <td>
             </td>
            </tr>
            <tr>
             <td>
              jti
             </td>
             <td>
             </td>
             <td>
              UUID
             </td>
            </tr>
            <tr>
             <td>
              response_types
             </td>
             <td>
              code, code id_token
             </td>
             <td>
              UUJSON array containing a list of the OAuth 2.0 response_type values that the Client is declaring that it will restrict itself to using
             </td>
            </tr>
            <tr>
             <td>
              id_token_signed_response_alg
             </td>
             <td>
              PS256
             </td>
             <td>
              JWS alg algorithm
             </td>
            </tr>
            <tr>
             <td>
              software_statement
             </td>
             <td>
             </td>
             <td>
              UUID
             </td>
            </tr>
           </tbody>
          </table>
          <p>
           2.1 Example Registration Request JWT (Python)
This code is compatible with python3.6 and requires the jwcrypto module (pip install jwcrypto)
          </p>
          <pre><code>import time, uuid
from jwcrypto import jwt
from jwcrypto import jwk

# The software statement ID (software_id) of the software statement created in software statements (MIT).
SOFTWARE_STATEMENT_ID = ""
#  Value of the kid parameter associated with the signing certificate generated in Generate a
# transport/signing certificate pair (please note that you need to use the signing certificate kid).
KID = ""
# Your private signing key. You will use this to sign your JWT.
PRIVATE_RSA_KEY = """
-----BEGIN PRIVATE KEY-----
-----END PRIVATE KEY-----
"""

SOFTWARE_STATEMENT = ""

def make_registration_jwt(software_statement_id: str, kid: str, software_statement: str) -&gt; str:
    jwt_iat = int(time.time())
    jwt_exp = jwt_iat + 3600
    header = dict(alg='RS256', kid=kid, typ='JWT')
    claims = dict(
        token_endpoint_auth_signing_alg="PS256",
        grant_types=["authorization_code", "client_credentials"],
        subject_type="public",
        application_type="web",
        iss=software_statement_id,
        redirect_uris=["https://app.getpostman.com/oauth2/callback"],
        token_endpoint_auth_method="client_secret_basic",
        aud="0015800001ZEc3hAAD",
        scope= "openid accounts payments",   #accounts for AISP or payments for PISP or both
        request_object_signing_alg="none",
        exp=jwt_exp,
        iat=jwt_iat,
        jti=str(uuid.uuid4()),
        response_types=["code", "code id_token"],
        id_token_signed_response_alg="RS256",
        software_statement=software_statement
     )

    token = jwt.JWT(header=header, claims=claims)
    key_obj = jwk.JWK.from_pem(PRIVATE_RSA_KEY.encode('latin-1'))
    token.make_signed_token(key_obj)
    signed_token = token.serialize()

    print(signed_token)
    return signed_token

make_registration_jwt(SOFTWARE_STATEMENT_ID, KID, SOFTWARE_STATEMENT)
</code></pre>
          <p>
           2.2 Request Registration Endpoint Example (Python):
          </p>
          <pre><code>headers = {'Content-Type': 'application/jwt'}
client = ('./transport.pem', './transports.key')
response = requests.post("https://ob-api1.sandbox.tide.co:4501/v1.0/dynamic-client-registration/v3.1/register",
                                registration_request,
                                headers=headers,
                                verify=False,
                                cert=client
                                )
print(response.content)
</code></pre>
          <p>
           The response you get from this registration is exactly the same as the one described by the OIDC dynamic registration.
You should now have successfully onboarded your TPP with the ASPSP and received a client ID; you will need this client ID for future interactions with the ASPSP.
          </p>
          <p>
           2.3 Environment File download
          </p>
          <p>
           Once a TPP successfully registers to Ozone, they can download the environment file for their client via an ozone helper api
          </p>
          <pre><code>Endpoint: https://ob-api1.sandbox.tide.co:4501/ozone/v1.0/postman/environment

Headers: Authorization: Basic &lt;token&gt;
The token is the base64 encoded string of clientId:clientsecret
</code></pre>
          <p>
           On successful response the TPP can then save the environment file on to their local system.
          </p>
          <h2>
           Step 3: Import Environment Files and Collections To Postman
          </h2>
          <p>
           3.1. Import Environment Files and Collections into Postman
          </p>
          <p>
           <img alt="" src="../../assets/images/postmanimport1.png"/>
          </p>
          <p>
           <img alt="" src="../../assets/images/postmanimport2.png"/>
          </p>
          <p>
           3.2) Check URLs and Environments are loaded successfully
          </p>
          <p>
           3.3) Add Client Certificates
Add the following ASPSP end points into Postman;
           <a href="https://ob-api1.sandbox.tide.co:4501">
            https://ob-api1.sandbox.tide.co:4501
           </a>
           <a href="https://ob-auth1.sandbox.tide.co:4201/token">
            https://ob-auth1.sandbox.tide.co:4201/token
           </a>
          </p>
          <p>
           The CRT should be set to the transport certificate downloaded from the open banking directory. The Key value should be set to the private key for the transport certificate.
          </p>
          <p>
           3.4) SSL Certificate Verification (TPP)
In Postman settings ensure SSL Certificate Verification is set to off.
          </p>
          <h2>
           Step 4: Account Information Flow
          </h2>
          <p>
           4.1) Client Credentials Grant
          </p>
          <p>
           <img alt="" src="../../assets/images/ccg.png"/>
          </p>
          <p>
           4.2) Account Access Consent
          </p>
          <p>
           <img alt="" src="../../assets/images/accountaccess.png"/>
          </p>
          <p>
           4.3) PSU Consent Flow
TPPs can generate the consent flow URL by postman
          </p>
          <p>
           <img alt="" src="../../assets/images/consent1.png"/>
          </p>
          <p>
           Once the URL is constructed, open the URL to initiate the PSU consent flow
          </p>
          <p>
           Authenticate user
          </p>
          <p>
           <img alt="" src="../../assets/images/consent2.png"/>
          </p>
          <p>
           Sandbox User Accounts
          </p>
          <table>
           <thead>
            <tr>
             <th>
              user
             </th>
             <th>
              password
             </th>
            </tr>
           </thead>
           <tbody>
            <tr>
             <td>
              rora
             </td>
             <td>
              rora
             </td>
            </tr>
            <tr>
             <td>
              mits
             </td>
             <td>
              mits
             </td>
            </tr>
            <tr>
             <td>
              ivsa
             </td>
             <td>
              ivsa
             </td>
            </tr>
           </tbody>
          </table>
          <p>
           Select accounts
          </p>
          <p>
           <img alt="" src="../../assets/images/consent3.png"/>
          </p>
          <p>
           Once the PSU consent is successful, Ozone bank will redirect back to the redirect URI. Copy the auth code from the URL
          </p>
          <p>
           <img alt="" src="../../assets/images/consent4.png"/>
          </p>
          <p>
           4.4) Generate the access token
          </p>
          <p>
           <img alt="" src="../../assets/images/accesstoken.png"/>
          </p>
          <h2>
           Step 5: Retrieve Account and Transaction Data
          </h2>
          <p>
           Retrieve Account Data
          </p>
          <p>
           <img alt="" src="../../assets/images/accounts.png"/>
          </p>
          <p>
           Retrieve Transaction Data
          </p>
          <p>
           <img alt="" src="../../assets/images/transactions.png"/>
          </p>
         </div>
         <div class="card pos-fixed wd-250 markdown-toc d-none d-md-block d-lg-block d-xl-block" style="right: 35px; top: 200px;">
          <div class="card-header bg-primary tx-bold toc-title tx-white">
           Table of Content
          </div>
          <div class="card-body bg-light toc-container pl-0 pr-0">
           Please wait
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div>
  <script src="/js/libs.js">
  </script>
  <script src="/js/aside.js">
  </script>
  <script src="/js/o3.js">
  </script>
  <script src="/js/ozone.js">
  </script>
  <script src="/js/sticky.js">
  </script>
  <script src="/js/markdown/links.js">
  </script>
  <script src="/js/markdown.js">
  </script>
  <footer class="footer content">
   <div>
    <span>
    </span>
   </div>
  </footer>
 </body>
</html>
